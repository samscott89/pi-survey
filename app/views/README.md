Views  
======  
  
This page covers the views used in the application. This is arguably the most complicated section of the whole application, since there is html, generated by embedded Ruby, mixed with templates, partial views and CSS. While the control flow of the pages is controlled by the Controllers.  
  
A partial is a chunk of code which can be reused, and inserted into a page (see: [RailsGuide: Using Partials](http://guides.rubyonrails.org/layouts_and_rendering.html#using-partials)). They are useful for either breaking up the code, or for common code which can be reused. In survey_sections, they have a particularly important use: each question type has an associated partial, which renders the question dynamically when the page is loaded.   
  
  
  
Layouts  
--------  
  
Contained in /app/views/layouts, these are the general templates which pages will use by default.  
  
### application.html.erb  
This is the general template which all pages will use by default. A different default can be specified by `render layout: 'other_template'`, or with `layout: false` for no layout.  
  
In the current version of this file we have a few main components. The head of the html contains:  
  
    <head>  
      <title><%= full_title(yield(:title)) %></title>  
      <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>  
      <%= javascript_include_tag "application", "data-turbolinks-track" => true %>  
      <%= csrf_meta_tags %>  
      <%= render 'layouts/shim' %>  
    </head>  
    
This is some pretty standard code which will be in most Rails projects. We have the title of the page, which is generated dynamically by a helper function `full_title()` located in /app/helpers/application_helper.rb.  
  
`stylesheet_link_tag` and `javascript_include_tag` write the lines to import CSS and javascript files respectively (more [Asset Pipeline](http://guides.rubyonrails.org/asset_pipeline.html) magic).  
  
Whereas the `csrf_meta_tags` are designed to stop Cross-Site Request Forgery Attacks (essentially, tricking someone into submitting details from another website).  
  
The `render 'layouts/shim'` uses the partial _shim.html.erb which is used for IE browswers which don't support HTML5.  
  
All very boring, routine stuff!  
  
  
The body of the layout looks like roughly like this:  
  
    <%= render 'layouts/header' %>  
    ...  
    <%= yield %>  
    <%= render 'layouts/footer' %>  

    <%= debug(params) if Rails.env.development? %>  
    
Here, we have a header and a footer rendered, which also have associated partials. Plus a debug line which shows debugging parameters only when the server is running in development mode.  
  
Finally, the line `<%= yield %>`, which essentially tells Rails where to drop in the rest of the content.  
  
The rest of the body is dedicated to code which displays any 'flash' messages. For example, success and error messages. See: [RailsGuides: The Flash](http://guides.rubyonrails.org/action_controller_overview.html#the-flash).  
  
Questions  
--------  
  
Current questions does not have any views. However, this will probably change when trying to deal with editing questions in place in the edit survey page.  
  
  
Sessions  
--------  
  
The only view for sessions is new.html.erb. It is used for users signing in, since this constitutes a user creating a new session with the server.  
Shared  
--------  
  
This folder is used for storing partial views common to multiple views.  
  
Currently contains _error_messages.html.erb and is currently used by users#new to display errors when a user is creating a new profile.  
  
This should also be used by survey_sections#show, but currently that is re-implemented by _answer_error_messages.html.erb due to some differences in the error handling.  
  
TODO:  
  * Refactor `_answer_error_messages` into `_error_messages`  
    
  
Static Pages  
-------------  
  
The static pages are any of the pages which simply display content, without any interaction or control flow needed.  
  
Currently, these are about, contact, help and home. As you might expect to find on a website. However, these do not have any content at this point, except home which is a rudimentary homepage.  
  
TODO:  
  * Create static content  
    
  
  
Surveys  
--------  
  
As expected, the views section for surveys is a bit meatier. Surveys as a resource implement most of the main actions: show, index, new, edit, plus an additional finish action.  
  
### show  
  
The show view is used for displaying the front page of a survey. This is the first page which a user will see for a survey, and gives the instructions and description of the survey.  
  
At a later date, this will include other information such as the survey creator, and branding.  
  
TODO:  
  * Add more details to survey#show page.  
  
### index  
  
The index view gives a list of all the surveys. This is accomplished by use of the package "paginate" which automatically generates pages to display long lists. Each list item is rendered by the incredibly concise line `render @surveys`.  
  
The `@surveys` object is a local variable created by the surveys_controller, and the render command uses the corresponding _survey.html.erb partial to render each list item.  
  
Therefore, to change the appearance of list items, it is only necessary to change the partial view.  
  
TODO:  
  * Advanced list features: sort by tag, show completed/not completed etc.  
  * The list of surveys should be user-dependant. However, this will probably be performed in the controller instead.  
  
### new  
  
The new view is used to create new surveys. This is currently a very basic version of the page, but does the job quite well.  
  
TODO:  
  * Error handling  
  * Add more detail to page  
  
### edit  
  
The edit page is one of the most complex views, and should probably be refactored into partials where possible.  
  
There are two main sections to the page: a form for adding new questions on the left (id: survey-options); and the tabinated content in the centre showing the current state of the survey. Some of the functionality on the page is provided by javascript. The javascript file /app/assets/javascipts/surveys.js which is included at the top of the file.  
  
The javascript handles some internal functions, such as recording which is the current visible survey section (for adding the question to), and also user functions such as adding a new option to a question.  
  
The form for adding questions is quite straightforward. However, the link (id: add-question-option) has a javascript function attached to it which essentially adds a new question option by cloning the div with id question-option.  
  
The other part of the code is dedicated to generating the tab content. The actual display of tabs is handled by bootstrap in a fairly clear way. (See: [Bootstrap: tabs](http://getbootstrap.com/components/#nav-tabs).  
  
TODO:  
  * Clean up and refactor view.  
  * Implement editing of the survey in place. Removing, moving and editing questions; changing the order of the sections, etc.  
  
  
### finish  
  
This page is not really implemented. When a survey is finished (there are no more survey sections left) the user is redirected to this page.  
  
TODO:  
  * Add more to this page.  
  
  
Survey Sections   
--------  
  
Along with Surveys, this is also a pretty meaty section. However, most of the functionality is performed in show.html.erb with some useful partials.  
  
There is also the `_answer_error_message.html.erb` partial which is used to display any errors to the user when they are submitting answers.  
  
TODO:   
  * Refactor the _answer_error_message partial into a generic error_message partial used by other pages.  
  
### show  
  
This is the core functionality of the website - the page to answer survey questions.  
  
    <fieldset>  
    <legend><%= "Section #{@survey_section.id}: " + @survey_section.title %></legend>  
    <%= form_tag submit_answer_path(@survey, @survey_section.index), action: "post", role: "form" do %>  
      
    	<% @questions.each do |q| %>    
    		<%= fields_for "answers[#{q.id}]", Answer.new do |f| %>  
    			<%= render partial: "survey_sections/question_types/#{q.option_group.question_type.name}", locals: { f: f, q: q}, layout: "survey_sections/question_types/question"  %>  
    		<% end %>  
    	<% end %>  
      
    	  
    	<div class="form-actions">  
    	<%= submit_tag "Submit answer", class: 'btn btn-primary' %>  
    	</div>  
    <% end %>  
    </fieldset>  
  
The key part is the internal loop `@questions.each` which takes each question, creates a 'mini-form' (tohe fields\_for), and then renderers the question by taking the relevant partial (selected by question_type).  
  
Additionally, some parameters are passed to the partial. `f` is the form for the question, and `q` is the question object, which will be used by the partials to access those objects. Also, there is a partial \_question.html.erb which is passed through as the layout for the question. This wraps the question in some CSS.   
  
### answer  
  
This page will not actually be shown in production. It can be useful for debugging purposes to have a page shown after each section is submitted.   
    
  
  
Users  
--------  
  
Handled by Devise, with some extra customisation.