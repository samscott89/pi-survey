<% provide(:title, @survey.name) %>
<% content_for :js_include do %>
<%= javascript_include_tag :modernizr %>
<%= javascript_include_tag "surveys" %>
<% end %>

<div class="row">
	<div class="col-md-2"></div>
		<div class="col-md-8">
		<div class="progress">
			<div class="progress-bar progress-bar-striped" role="progressbar"
			aria-valuenow="<%= (@survey_section.idx)-1 %>" aria-valuemin="0" aria-valuemax="<%= @survey_section_last %>" style="width:<%= (((@survey_section.idx.to_f)-1)/@num_sections.to_f)*100 %>%">
			<%= (((@survey_section.idx.to_f-1)/@num_sections.to_f)*100).to_i %>% Completed
			</div>
		</div>
	</div>
	<div class="col-md-2"></div>
</div>

<div class="row">
<div class="col-md-2"></div>
<div class="col-md-8 well">

<fieldset>
<legend><%= "Section #{@survey_section.idx}: " + @survey_section.title %></legend>

<h4><%= @survey_section.subtitle %></h4>	

<%= form_tag survey_answer_path(@survey, @survey_section.idx), action: "post", role: "form", class: "col-md-12" do %>

	<% @questions.each do |q| %>
		<% ans = @answers[q.id] %>
		<% ans ||= Answer.new(question_id: q.id) %>
		<% ans_options = ans.answer_options %>
		<% ans.answer_options.build if ans_options.empty? %>
		<div class="<%= 'has-error' unless ans.errors.empty? %>">
			<%= fields_for "answers[#{q.id}]", ans do |f| %>
				<%= f.hidden_field :question_id, value: q.id %>
				<%= render partial: "survey_sections/question_types/#{q.option_group.question_type.name}", locals: { f: f, q: q, ans_options: ans_options}, layout: 'survey_sections/question_types/question'  %>
			<% end %>
		</div>
	<% end %>

	
	<div class="form-actions">
	<%= submit_tag "Submit answer", class: 'btn btn-primary', disabled: (!@active_survey.nil? and @active_survey.completed?) %>
	</div>
<% end %>
</fieldset>

</div>
<div class="col-md-2"></div>
</div>