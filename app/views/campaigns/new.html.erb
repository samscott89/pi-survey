<%= provide(:title, "Create New Campaign") %>

<%= javascript_include_tag "campaigns" %>


<div class="row well">
  <div class="col-sm-8 col-sm-offset-1">
	<%= form_for @campaign do |f| %>
		<legend>Create a new campaign</legend>
		<fieldset class="form-horizontal">
		<div class="form-group">
  		  <%= f.label :name, class: "col-sm-1 control-label"%>
		  <div class="col-sm-5">
			<%= f.text_field :name, class: "form-control" %>
		  </div>
		</div>
      </fieldset>
      <legend>Add Surveys to Campaign</legend>
		<fieldset class="form-inline">
		<% if @user_surveys.empty? %>
		<div class="alert alert-danger" role="alert">
			<b>You do not currently have any surveys to add.</b> <br>
			<br>
			Please create a survey first.
			<%= link_to "Create survey", new_survey_path, class: "btn btn-primary btn-large" %>
		</div>
		<% else %>
			<%# This is essentially a dummy template for adding new surveys.
			Javascript handles cloning this for new entries.  %>		
			<div id="campaign-surveys">
			<%= f.fields_for :campaign_surveys, CampaignSurvey.new, role: "form" do |f2| %>
			<div class="form-group">
				<%= f2.label :survey_id, class: "control-label" %>
				<% opt = [[nil, 0]].concat @user_surveys.map{|srv| [srv.name, srv.id]} %>
				<%= f2.select :survey_id, options_for_select(opt), {}, {class: "form-control"} %>
				<span class="help-block"><br></span>
			</div>

			<div class="form-group">
				<% date_value ||= Time.now.strftime("%Y-%m-%d") %>
				<%= f2.label :start_date, class: "control-label" %>
				<%= f2.date_field :start_date, class: "form-control", value: date_value %>
				<span class="help-block"><br></span>
			</div>

			<div class="form-group">
				<%= f2.label :end_date, class: "control-label" %>
				<%= f2.date_field :end_date, class: "form-control" %>
				<span class="help-block">Leave empty for indefinite.</span>
			</div>
			<% end %>
			</div>	
			<%= link_to "Add more", "#", id: "add-campaign-survey" %>
		<% end %>

	</fieldset>
<br>
<br>
	<%= f.submit "Create", class: "btn btn-large btn-primary" %>

	<% end %>
  </div>
</div>
